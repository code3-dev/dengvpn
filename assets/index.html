<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DengVPN</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
  <style>
    :root {
      --primary-color: #6C5CE7;
      --primary-hover: #5649C0;
      --secondary-color: #2C2F47;
      --text-color: #ffffff;
      --bg-color: #1A1C2E;
      --card-color: #252839;
      --card-hover: #2E3150;
      --connected-color: #00D0A6;
      --disconnected-color: #FF6B6B;
      --button-shadow: 0 10px 20px rgba(108, 92, 231, 0.3);
      --accent-gradient: linear-gradient(135deg, #6C5CE7, #00D0A6);
      --header-height: 70px;
      --footer-height: 60px;
      --border-radius: 16px;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-tertiary: rgba(255, 255, 255, 0.5);
      --card-padding: clamp(15px, 4vw, 40px);
      --container-max-width: min(95%, 600px);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', 'Segoe UI', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      height: 100vh;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-size: 16px;
      line-height: 1.5;
    }
    
    .app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-width: 100%;
      overflow: hidden;
    }
    
    .header {
      height: var(--header-height);
      background: rgba(30, 30, 45, 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 clamp(15px, 4vw, 30px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      z-index: 10;
      position: relative;
      flex-shrink: 0;
    }
    
    .header-left {
      display: flex;
      align-items: center;
    }
    
    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    
    .logo {
      font-size: clamp(18px, 5vw, 24px);
      font-weight: 700;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .status-indicator {
      display: flex;
      align-items: center;
      background: rgba(30, 30, 45, 0.8);
      padding: 8px 16px;
      border-radius: 30px;
      font-weight: 500;
      font-size: clamp(12px, 3vw, 14px);
    }
    
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 10px;
      background-color: var(--disconnected-color);
      box-shadow: 0 0 10px var(--disconnected-color);
      flex-shrink: 0;
    }
    
    .dot.connected {
      background-color: var(--connected-color);
      box-shadow: 0 0 10px var(--connected-color);
    }
    
    .proxy-status {
      padding: 8px 16px;
      background: rgba(30, 30, 45, 0.8);
      border-radius: 30px;
      font-size: clamp(12px, 3vw, 14px);
      color: var(--text-secondary);
      white-space: nowrap;
    }
    
    .proxy-enabled {
      color: var(--connected-color);
    }
    
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: clamp(10px, 3vw, 30px);
      background: radial-gradient(circle at center, #252839, #1A1C2E);
      overflow-y: auto;
      position: relative;
      width: 100%;
    }
    
    .main-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('data:image/svg+xml;utf8,<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><circle cx="2" cy="2" r="1" fill="rgba(255,255,255,0.03)"/></svg>');
      background-repeat: repeat;
      pointer-events: none;
    }
    
    .connection-card {
      background-color: var(--card-color);
      border-radius: var(--border-radius);
      padding: var(--card-padding);
      width: var(--container-max-width);
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
      animation: cardAppear 0.4s ease-out;
      margin: 0 auto;
    }
    
    @keyframes cardAppear {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes glow {
      0% { box-shadow: 0 0 5px rgba(108, 92, 231, 0.5); }
      50% { box-shadow: 0 0 20px rgba(108, 92, 231, 0.8); }
      100% { box-shadow: 0 0 5px rgba(108, 92, 231, 0.5); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .connection-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: var(--accent-gradient);
    }
    
    .connection-status {
      font-size: clamp(18px, 5vw, 24px);
      margin-bottom: clamp(15px, 5vh, 30px);
      text-align: center;
      font-weight: 600;
    }
    
    .connection-status.connected {
      color: var(--connected-color);
    }
    
    .connection-status.disconnected {
      color: var(--text-color);
    }
    
    .server-select-container {
      width: 100%;
      margin-bottom: 30px;
      position: relative;
    }
    
    .server-select {
      width: 100%;
      padding: 16px 20px;
      background-color: rgba(30, 30, 45, 0.7);
      border: 1px solid rgba(93, 95, 239, 0.3);
      border-radius: 12px;
      color: var(--text-color);
      font-size: 16px;
      font-weight: 500;
      appearance: none;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .server-select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(93, 95, 239, 0.25);
    }
    
    .server-select:hover {
      border-color: var(--primary-color);
      background-color: rgba(40, 40, 60, 0.8);
    }
    
    .server-select:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .server-select option {
      background-color: #252836;
      color: var(--text-color);
      padding: 10px;
      font-size: 16px;
    }
    
    .server-select-icon {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      color: var(--primary-color);
      transition: transform 0.3s ease;
    }
    
    .server-select:focus + .server-select-icon {
      transform: translateY(-50%) rotate(180deg);
    }
    
    /* Custom select styling */
    .select-wrapper {
      position: relative;
      width: 100%;
    }
    
    /* Add more modern appearance to the select with a floating label */
    .select-label {
      position: absolute;
      left: 20px;
      top: -10px;
      font-size: 12px;
      font-weight: 500;
      color: var(--primary-color);
      background-color: var(--card-color);
      padding: 0 8px;
      border-radius: 4px;
      z-index: 1;
    }
    
    .connection-button-container {
      width: clamp(100px, 25vw, 150px);
      height: clamp(100px, 25vw, 150px);
      position: relative;
      margin-bottom: clamp(15px, 5vh, 30px);
    }
    
    .connection-progress {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(var(--primary-color) 0%, rgba(30, 30, 45, 0.3) 0%);
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      transition: background 1s ease;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    
    .connection-button {
      width: calc(100% - 20px);
      height: calc(100% - 20px);
      border-radius: 50%;
      background-color: rgba(30, 30, 45, 0.8);
      border: none;
      color: var(--text-color);
      font-size: clamp(14px, 4vw, 18px);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      z-index: 2;
      box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }
    
    .connection-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, rgba(108, 92, 231, 0.2), transparent);
      opacity: 0.7;
    }
    
    .connection-button:hover {
      transform: scale(1.05);
      box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.4);
    }
    
    .connection-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: scale(1);
    }
    
    .connection-button.connected {
      background-color: var(--connected-color);
      color: #151825;
      font-weight: 700;
      animation: glow 2s infinite;
    }
    
    .connection-button.connected::before {
      background: radial-gradient(circle at center, rgba(255, 255, 255, 0.3), transparent);
    }
    
    .connection-status-name {
      font-size: 16px;
      font-weight: 500;
      margin-top: 15px;
      text-align: center;
      color: var(--text-secondary);
      transition: color 0.3s ease;
    }
    
    .server-details {
      margin-top: 30px;
      margin-bottom: 10px;
      text-align: left;
      width: 100%;
      background: rgba(20, 20, 35, 0.4);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(108, 92, 231, 0.1);
      animation: fadeIn 0.5s ease-out;
    }
    
    .detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .detail-row:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
    
    .detail-label {
      color: var(--text-secondary);
      font-weight: 500;
      font-size: clamp(12px, 3vw, 14px);
    }
    
    .detail-value {
      font-weight: 600;
      word-break: break-all;
      text-align: right;
      margin-left: 10px;
      font-size: clamp(12px, 3vw, 14px);
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      width: 100%;
    }
    
    .stat-card {
      background-color: rgba(20, 20, 35, 0.4);
      padding: 20px 10px;
      border-radius: 12px;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(108, 92, 231, 0.1);
      animation: fadeIn 0.5s ease-out;
    }
    
    .stat-card:nth-child(1) { animation-delay: 0.1s; }
    .stat-card:nth-child(2) { animation-delay: 0.2s; }
    .stat-card:nth-child(3) { animation-delay: 0.3s; }
    
    .stat-card:hover {
      background-color: rgba(20, 20, 35, 0.6);
      transform: translateY(-3px);
      border-color: var(--primary-color);
    }
    
    .stat-value {
      font-size: clamp(18px, 5vw, 24px);
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--primary-color);
      position: relative;
      z-index: 1;
    }
    
    .stat-label {
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 500;
      position: relative;
      z-index: 1;
    }
    
    .stat-change {
      position: absolute;
      font-size: 12px;
      font-weight: 500;
      top: 10px;
      right: 10px;
      padding: 3px 6px;
      border-radius: 4px;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 2;
    }
    
    .stat-change.up {
      background-color: rgba(61, 213, 152, 0.2);
      color: var(--connected-color);
    }
    
    .stat-change.down {
      background-color: rgba(255, 87, 95, 0.2);
      color: var(--disconnected-color);
    }
    
    .stat-change.show {
      opacity: 1;
    }
    
    .stat-history {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 25px;
      display: flex;
      align-items: flex-end;
      padding: 0 5px;
      opacity: 0.5;
    }
    
    .stat-bar {
      flex: 1;
      background-color: var(--primary-color);
      margin: 0 1px;
      transition: height 0.3s ease;
    }
    
    .footer {
      height: var(--footer-height);
      background: rgba(30, 30, 45, 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 0 clamp(15px, 4vw, 30px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: clamp(12px, 3vw, 14px);
      color: var(--text-tertiary);
      flex-shrink: 0;
    }
    
    .loading {
      width: 30px;
      height: 30px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top: 3px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .no-servers {
      color: rgba(255, 255, 255, 0.5);
      text-align: center;
      padding: 20px;
    }
    
    /* Media Queries for Responsive Design */
    @media (max-width: 768px) {
      .header {
        padding: 0 20px;
      }
      
      .stats {
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }
      
      .stat-card {
        padding: 15px 10px;
      }
      
      .connection-card {
        padding: 25px;
      }
      
      .footer {
        padding: 0 20px;
        font-size: 12px;
      }
    }
    
    @media (max-width: 480px) {
      .header {
        height: auto;
        padding: 15px;
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .header-right {
        width: 100%;
        justify-content: space-between;
      }
      
      .status-indicator, .proxy-status {
        padding: 6px 12px;
        font-size: 12px;
      }
      
      .stats {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .stat-card {
        padding: 15px;
      }
      
      .connection-card {
        padding: 20px;
      }
      
      .server-select {
        padding: 12px 15px;
      }
      
      .connection-status {
        margin-bottom: 20px;
      }
      
      .footer {
        flex-direction: column;
        gap: 5px;
        align-items: center;
        height: auto;
        padding: 10px;
        text-align: center;
      }
    }
    
    /* Small windows optimization */
    @media (max-height: 600px) {
      .connection-button-container {
        width: clamp(80px, 20vw, 120px);
        height: clamp(80px, 20vw, 120px);
        margin-bottom: 15px;
      }
      
      .connection-status {
        margin-bottom: 15px;
      }
      
      .server-select-container {
        margin-bottom: 15px;
      }
      
      .server-details {
        margin-top: 15px;
      }
      
      .header, .footer {
        height: auto;
        padding-top: 10px;
        padding-bottom: 10px;
      }
      
      .main-content {
        padding: 10px;
      }
    }
    
    /* Improved scrollbar for all devices */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: rgba(30, 30, 45, 0.5);
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-hover);
    }
    
    /* Touch device optimizations */
    @media (hover: none) {
      .connection-button:hover {
        transform: none;
      }
      
      .stat-card:hover {
        transform: none;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header class="header">
      <div class="header-left">
        <div class="logo">DengVPN</div>
      </div>
      <div class="header-right">
        <div class="status-indicator">
          <div class="dot" id="status-dot"></div>
          <span id="status-text">Disconnected</span>
        </div>
        <div class="proxy-status">
          <span id="proxy-status-text">Proxy: Disabled</span>
        </div>
      </div>
    </header>
    
    <div class="main-content">
      <div class="connection-card">
        <h2 class="connection-status" id="connection-status">Select a server to connect</h2>
        
        <div class="server-select-container">
          <div class="select-wrapper">
            <div class="select-label">Server Location</div>
            <select class="server-select" id="server-select">
              <option value="-1" disabled selected>Select a server...</option>
              <!-- Server options will be populated dynamically -->
            </select>
            <div class="server-select-icon">
              <svg width="14" height="8" viewBox="0 0 14 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 1L7 7L13 1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
        </div>
        
        <div class="connection-button-container">
          <div class="connection-progress" id="connection-progress">
            <button class="connection-button" id="connect-button" disabled>Connect</button>
          </div>
          <div class="connection-status-name" id="connection-status-name">Not Connected</div>
        </div>
        
        <div class="server-details" id="server-details">
          <!-- Server details will be populated dynamically -->
        </div>
        
        <div class="stats">
          <div class="stat-card">
            <div class="stat-value" id="ping-value">--</div>
            <div class="stat-label">Ping (ms)</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="download-value">--</div>
            <div class="stat-label">Download</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="upload-value">--</div>
            <div class="stat-label">Upload</div>
          </div>
        </div>
      </div>
    </div>
    
    <footer class="footer">
      <div>DengVPN v1.3.0</div>
      <div>© 2025 DengVPN</div>
    </footer>
  </div>
  
  <script>
    // Variables to store state
    let selectedServerIndex = -1;
    let isConnected = false;
    let configs = [];
    let serverDetailElements = {};
    let statHistory = {
      ping: Array(10).fill(0),
      download: Array(10).fill(0),
      upload: Array(10).fill(0)
    };
    let lastStats = {
      ping: 0,
      download: 0,
      upload: 0
    };
    
    // DOM Elements
    const serverSelect = document.getElementById('server-select');
    const connectButton = document.getElementById('connect-button');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');
    const proxyStatusText = document.getElementById('proxy-status-text');
    const connectionStatus = document.getElementById('connection-status');
    const connectionStatusName = document.getElementById('connection-status-name');
    const connectionProgress = document.getElementById('connection-progress');
    const serverDetails = document.getElementById('server-details');
    const pingValue = document.getElementById('ping-value');
    const downloadValue = document.getElementById('download-value');
    const uploadValue = document.getElementById('upload-value');
    
    // Create stat history elements for each stat
    function createStatHistories() {
      const statCards = document.querySelectorAll('.stat-card');
      
      statCards.forEach(card => {
        // Add change indicator
        const statChange = document.createElement('div');
        statChange.className = 'stat-change';
        card.appendChild(statChange);
        
        // Add history chart
        const historyContainer = document.createElement('div');
        historyContainer.className = 'stat-history';
        
        // Add 10 bars for history
        for (let i = 0; i < 10; i++) {
          const bar = document.createElement('div');
          bar.className = 'stat-bar';
          bar.style.height = '0px';
          historyContainer.appendChild(bar);
        }
        
        card.appendChild(historyContainer);
      });
    }
    
    // Update stat history visualization
    function updateStatHistory(type, value) {
      // Get the correct elements
      let statCard;
      if (type === 'ping') {
        statCard = pingValue.closest('.stat-card');
      } else if (type === 'download') {
        statCard = downloadValue.closest('.stat-card');
      } else if (type === 'upload') {
        statCard = uploadValue.closest('.stat-card');
      }
      
      if (!statCard) return;
      
      // Update history array (shift left and add new value)
      statHistory[type].shift();
      statHistory[type].push(parseFloat(value) || 0);
      
      // Get max value for scaling
      const maxValue = Math.max(...statHistory[type], 1);
      
      // Update history bars
      const bars = statCard.querySelectorAll('.stat-bar');
      statHistory[type].forEach((val, index) => {
        const bar = bars[index];
        const height = (val / maxValue) * 20;
        bar.style.height = `${height}px`;
      });
      
      // Show change indicator
      showStatChange(type, value);
    }
    
    // Show stat change indicator
    function showStatChange(type, currentValue) {
      // Get the previous value
      const prevValue = lastStats[type];
      currentValue = parseFloat(currentValue) || 0;
      
      // Get the stat card and change indicator
      let statCard;
      if (type === 'ping') {
        statCard = pingValue.closest('.stat-card');
      } else if (type === 'download') {
        statCard = downloadValue.closest('.stat-card');
      } else if (type === 'upload') {
        statCard = uploadValue.closest('.stat-card');
      }
      
      if (!statCard) return;
      
      const changeIndicator = statCard.querySelector('.stat-change');
      
      // For ping, lower is better, for others higher is better
      let isImproved = false;
      if (type === 'ping') {
        isImproved = currentValue < prevValue;
      } else {
        isImproved = currentValue > prevValue;
      }
      
      // Only show if there's a significant change
      const threshold = type === 'ping' ? 5 : 0.2;
      const diff = Math.abs(currentValue - prevValue);
      
      if (prevValue > 0 && diff > threshold) {
        // Clear previous classes
        changeIndicator.classList.remove('up', 'down', 'show');
        
        // Add new class
        if (isImproved) {
          changeIndicator.classList.add('up');
          changeIndicator.textContent = '↑';
        } else {
          changeIndicator.classList.add('down');
          changeIndicator.textContent = '↓';
        }
        
        // Show the indicator
        changeIndicator.classList.add('show');
        
        // Hide after 2 seconds
        setTimeout(() => {
          changeIndicator.classList.remove('show');
        }, 2000);
      }
      
      // Update last value
      lastStats[type] = currentValue;
    }
    
    // Parse VLESS URL
    function parseVlessUrl(vlessUrl) {
      try {
        // Format: vless://uuid@server:port?param1=value1&param2=value2#remarks
        const urlWithoutProtocol = vlessUrl.replace('vless://', '');
        
        // Split URL to get UUID and server part
        const uuidAndServer = urlWithoutProtocol.split('@');
        if (uuidAndServer.length < 2) {
          throw new Error('Invalid VLESS URL format');
        }
        
        const uuid = uuidAndServer[0];
        
        // Extract server address and port
        const serverPart = uuidAndServer[1].split('?')[0];
        const [serverAddress, serverPort] = serverPart.split(':');
        
        // Extract query parameters
        const paramsMatch = urlWithoutProtocol.match(/\?(.*?)#/);
        const params = paramsMatch ? paramsMatch[1] : '';
        
        // Parse the query parameters
        const queryParams = {};
        if (params) {
          params.split('&').forEach(param => {
            const [key, value] = param.split('=');
            if (key && value) {
              queryParams[key] = decodeURIComponent(value);
            }
          });
        }
        
        // Extract remarks (name)
        const remarksMatch = urlWithoutProtocol.match(/#(.*?)$/);
        const remarks = remarksMatch ? decodeURIComponent(remarksMatch[1]) : '';
        
        return {
          id: uuid,
          add: serverAddress,
          port: serverPort,
          net: queryParams.type || 'tcp',
          tls: queryParams.security === 'tls',
          path: queryParams.path || '/',
          host: queryParams.host || '',
          ps: remarks,
          protocol: 'vless'
        };
      } catch (error) {
        console.error('Error parsing VLESS URL:', error);
        return null;
      }
    }
    
    // Parse vmess URL to get server details
    function parseVmessUrl(vmessUrl) {
      try {
        const base64 = vmessUrl.replace('vmess://', '');
        // Use decodeURIComponent and escape to properly handle UTF-8 characters
        const decodedContent = decodeURIComponent(escape(atob(base64)));
        const parsedData = JSON.parse(decodedContent);
        parsedData.protocol = 'vmess';
        return parsedData;
      } catch (error) {
        console.error('Error parsing vmess URL:', error);
        return null;
      }
    }
    
    // Parse config URL (detects protocol type and calls appropriate parser)
    function parseConfigUrl(url) {
      if (url.startsWith('vmess://')) {
        return parseVmessUrl(url);
      } else if (url.startsWith('vless://')) {
        return parseVlessUrl(url);
      }
      return null;
    }
    
    // Format server name
    function formatServerName(serverConfig) {
      if (serverConfig.ps) {
        // Make sure the server name is properly displayed with UTF-8 characters
        try {
          return serverConfig.ps;
        } catch (e) {
          return `${serverConfig.protocol.toUpperCase()} - ${serverConfig.add}:${serverConfig.port}`;
        }
      } else {
        return `${serverConfig.protocol.toUpperCase()} - ${serverConfig.add}:${serverConfig.port}`;
      }
    }
    
    // Animate connection progress
    function animateConnectionProgress(connected, duration = 1000) {
      const startTime = performance.now();
      const startValue = connected ? 0 : 100;
      const endValue = connected ? 100 : 0;
      
      function updateProgress(currentTime) {
        const elapsedTime = currentTime - startTime;
        const progress = Math.min(elapsedTime / duration, 1);
        const currentValue = startValue + (endValue - startValue) * progress;
        
        connectionProgress.style.background = `conic-gradient(
          var(--primary-color) ${currentValue}%,
          transparent ${currentValue}%
        )`;
        
        if (progress < 1) {
          requestAnimationFrame(updateProgress);
        }
      }
      
      requestAnimationFrame(updateProgress);
    }
    
    // Update connection status UI
    function updateConnectionStatus(connected) {
      isConnected = connected;
      
      if (connected) {
        statusDot.classList.add('connected');
        statusText.textContent = 'Connected';
        proxyStatusText.textContent = 'Proxy: Enabled (127.0.0.1:1080)';
        proxyStatusText.classList.add('proxy-enabled');
        connectionStatus.textContent = 'VPN Connection Active';
        connectionStatus.classList.add('connected');
        connectionStatus.classList.remove('disconnected');
        connectButton.textContent = 'Disconnect';
        connectButton.classList.add('connected');
        connectionStatusName.textContent = 'Connected';
        
        // Disable server selection while connected
        serverSelect.disabled = true;
        
        // Animate connection progress
        animateConnectionProgress(true);
        
        // Start receiving stats updates
        window.vpn.requestStats();
      } else {
        statusDot.classList.remove('connected');
        statusText.textContent = 'Disconnected';
        proxyStatusText.textContent = 'Proxy: Disabled';
        proxyStatusText.classList.remove('proxy-enabled');
        connectionStatus.textContent = selectedServerIndex >= 0 ? 'Ready to connect' : 'Select a server to connect';
        connectionStatus.classList.remove('connected');
        connectionStatus.classList.add('disconnected');
        connectButton.textContent = 'Connect';
        connectButton.classList.remove('connected');
        connectionStatusName.textContent = 'Not Connected';
        
        // Enable server selection when disconnected
        serverSelect.disabled = false;
        
        // Animate connection progress
        animateConnectionProgress(false);
        
        // Reset stats when disconnected
        pingValue.textContent = '--';
        downloadValue.textContent = '--';
        uploadValue.textContent = '--';
        
        // Reset history
        resetStatHistory();
      }
    }
    
    // Reset stat history
    function resetStatHistory() {
      statHistory = {
        ping: Array(10).fill(0),
        download: Array(10).fill(0),
        upload: Array(10).fill(0)
      };
      
      lastStats = {
        ping: 0,
        download: 0,
        upload: 0
      };
      
      // Reset history bars
      const bars = document.querySelectorAll('.stat-bar');
      bars.forEach(bar => {
        bar.style.height = '0px';
      });
    }
    
    // Update stats
    function updateStats(stats) {
      if (!isConnected) return;
      
      pingValue.textContent = stats.ping;
      downloadValue.textContent = stats.download + ' MB/s';
      uploadValue.textContent = stats.upload + ' MB/s';
      
      // Update history
      updateStatHistory('ping', stats.ping);
      updateStatHistory('download', stats.download);
      updateStatHistory('upload', stats.upload);
    }
    
    // Render server list
    function renderServerList() {
      serverSelect.innerHTML = '';
      
      // Add default option
      const defaultOption = document.createElement('option');
      defaultOption.value = "-1";
      defaultOption.textContent = "Select a server...";
      defaultOption.disabled = true;
      defaultOption.selected = true;
      serverSelect.appendChild(defaultOption);
      
      if (configs.length === 0) {
        const noServerOption = document.createElement('option');
        noServerOption.value = "-1";
        noServerOption.textContent = "No servers available";
        noServerOption.disabled = true;
        serverSelect.appendChild(noServerOption);
        return;
      }
      
      configs.forEach((config, index) => {
        // Check if config is an object with name and url properties (new format)
        if (config.name && config.url) {
          const option = document.createElement('option');
          option.value = index;
          option.textContent = config.name;
          
          if (index === selectedServerIndex) {
            option.selected = true;
          }
          
          serverSelect.appendChild(option);
        } else {
          // Handle old format (direct VLESS/VMess URLs)
          const serverConfig = parseConfigUrl(config);
          if (!serverConfig) return;
          
          const option = document.createElement('option');
          option.value = index;
          option.textContent = formatServerName(serverConfig);
          
          if (index === selectedServerIndex) {
            option.selected = true;
          }
          
          serverSelect.appendChild(option);
        }
      });
    }
    
    // Update server details panel
    function updateServerDetails(serverConfig) {
      serverDetails.innerHTML = '';
      
      if (!serverConfig) {
        serverDetails.innerHTML = '<div class="no-servers">No server selected</div>';
        return;
      }
      
      const detailItems = [
        { label: 'Server', value: serverConfig.add },
      ];
      
      detailItems.forEach(item => {
        const row = document.createElement('div');
        row.className = 'detail-row';
        
        const label = document.createElement('div');
        label.className = 'detail-label';
        label.textContent = item.label;
        
        const value = document.createElement('div');
        value.className = 'detail-value';
        value.textContent = item.value;
        
        row.appendChild(label);
        row.appendChild(value);
        serverDetails.appendChild(row);
      });
    }
    
    // Handle server selection change
    function handleServerSelection() {
      const index = parseInt(serverSelect.value);
      if (index >= 0 && index < configs.length) {
        selectedServerIndex = index;
        connectButton.disabled = false;
        
        const config = configs[index];
        
        // Check if config is an object with name and url properties (new format)
        if (config.name && config.url) {
          // For new format, just show the server name
          const serverDetails = {
            add: config.name
          };
          
          updateServerDetails(serverDetails);
          
          if (!isConnected) {
            connectionStatus.textContent = 'Ready to connect';
            connectionStatusName.textContent = config.name;
          }
        } else {
          // Handle old format (direct VLESS/VMess URLs)
          const serverConfig = parseConfigUrl(config);
          updateServerDetails(serverConfig);
          
          if (!isConnected) {
            connectionStatus.textContent = 'Ready to connect';
            connectionStatusName.textContent = formatServerName(serverConfig);
          }
        }
      } else {
        selectedServerIndex = -1;
        connectButton.disabled = true;
        
        serverDetails.innerHTML = '<div class="no-servers">No server selected</div>';
        connectionStatus.textContent = 'Select a server to connect';
        connectionStatusName.textContent = 'Not Connected';
      }
    }
    
    // Connect or disconnect
    function toggleConnection() {
      if (isConnected) {
        window.vpn.disconnect();
      } else if (selectedServerIndex >= 0) {
        // Handle both old and new config formats
        const config = configs[selectedServerIndex];
        if (config.name && config.url) {
          // New format with name and url properties
          window.vpn.connectWithUrl(config.url);
        } else {
          // Old format (direct VLESS/VMess URLs)
          window.vpn.connect(selectedServerIndex);
        }
      }
    }
    
    // Initialize the app
    function initApp() {
      // Create stat history elements
      createStatHistories();
      
      // Get configs from main process
      window.vpn.getConfigs();
      
      // Listen for config updates
      window.vpn.onUpdateConfigs((updatedConfigs) => {
        configs = updatedConfigs;
        renderServerList();
      });
      
      // Listen for connection status updates
      window.vpn.onConnectionStatus((connected) => {
        updateConnectionStatus(connected);
      });
      
      // Listen for connection stats updates
      window.vpn.onConnectionStats((stats) => {
        updateStats(stats);
      });
      
      // Set up event listeners
      connectButton.addEventListener('click', toggleConnection);
      serverSelect.addEventListener('change', handleServerSelection);
    }
    
    // Initialize when the DOM is loaded
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>